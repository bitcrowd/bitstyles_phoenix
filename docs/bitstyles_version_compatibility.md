# Bitstyles version compatibility

General rules:

- We don't drop bitstyles version support. Users of bitstyles_phoenix should be able to upgrade bitstyles_phoenix to the newest version without having to upgrade bitstyles.
- We don't skip bitstyles versions. Users of bitstyles_phoenix should be able to upgrade bitstyles to any version between the highest and lowest currently supported bitstyles version.

## Doctests ("stories")

Component doctests (created with a custom `story` macro) describe components as their would render for the highest currently supported bitstyles version (default version).

## Versions showcase

Because doctests can only show how a bitstyles_phoenix component looks like with the default bitstyles versions, they can't be used to preview components with other bitstyles versions. 

A showcase of components in different versions can be generated by running:

```bash
mix run scripts/generate_version_showcase.ex
```

The script accepts multiple `--only` arguments if you want to limit the showcase to only a handful of versions:

```bash
mix run scripts/generate_version_showcase.ex --only 4.3.0 --only 4.2.0
```

This script will create a `version_showcase` directory with static web pages. Open the starting page with:

```bash
open version_showcase/index.html
```

## How to upgrade the default bitstyles version in bitstyles_phoenix?

1. Choose the smallest possible version jump (do not skip versions).
2. Read about the changes in version in [the bitstyles Changelog](https://github.com/bitcrowd/bitstyles/blob/main/CHANGELOG.md).
3. Update the highest supported version mentioned in the [README](../README.md).
4. Update the `@default_version` in [`BitstylesPhoenix.Bitstyles`](../lib/bitstyles_phoenix/bitstyles.ex).
5. Add the new version to the version lists in [`generate_version_showcase`](../scripts/generate_version_showcase.ex).
6. Handle classes renamed by bitstyles by adding new clauses of the `classname/2` function in [`BitstylesPhoenix.Bitstyles`](../lib/bitstyles_phoenix/bitstyles.ex).
7. If renaming classes is not enough to upgrade correctly, you can perform [a bitstyles version check in a component](#an-example-of-a-bitstyles-version-check-in-a-component).
8. Run `mix test`. Fix all doctests until `mix test` succeeds.
9. Run `mix docs` to preview components after making changes to them.
10. Use the [versions showcase](#versions-showcase) to test that you didn't break for older bitstyles versions.

### An example of a bitstyles version check in a component

```elixir
def ui_tricky_component(assigns) do
  version = BitstylesPhoenix.Bitstyles.version()

  if version >= "5.0.0" do
    ~H"""
      <p class={classnames("u-new-class-that-does-everything")}>...</p>
    """
  else
    ~H"""
      <div class={classnames("u-old-class1 u-old-class2")}>
        <div class={classnames("u-old-class3")}>
          ...
        </div>
      </div>
    """
  end
end
```

## Adding new components

Ideally, if you're adding a completely new component, make sure it works with all supported bitstyles versions by using the [versions showcase](#versions-showcase) to test it.

If it's not practical to support it in other version, you can perform [a bitstyles version check in the component](#an-example-of-a-bitstyles-version-check-in-a-component).
